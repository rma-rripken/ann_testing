module fnet_MTZ

! a = 2.4639e-005
! b = 0.1222

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.117195048388,-0.035580880250,-0.020726653757,1.079238944959,-0.053523387420,0.527573665883,-0.272203477111,-0.215083421546,-0.097844443022,-0.131786929878,0.028810558583,2.339568475537 &
            ,0.136271666613,0.223458633406,-0.585369330212,-0.066501553139,-0.014812771523,0.092345056670,0.069288363370,-1.019764231279,-0.010710204740,0.080810339368,0.219635331091,0.043079486442 &
            ,-0.048507204474,-0.016710370912,-0.033486340721,-0.421560709194,0.009719561441,0.035981339295,-0.252559919849,-0.116398219088,0.056055430016,-0.019333611975,-0.099490410379,-1.406456997617 &
            ,-0.005596130798,0.076127083934,-0.749118698490,0.000366291621,0.007212828817,0.071711436027,0.021907741688,-0.160668145790,0.010343235417,0.058246913271,0.439462038587,0.116538433046 &
            ,-0.018939538299,-0.018656505629,0.146114273132,2.208997060719,0.010641683415,-0.001252259260,0.173358752391,0.016482467122,0.091599982148,-0.095998335494,-0.319084875908,-5.194668931519 &
            ,0.100847933991,-0.145041456144,-0.185548619384,0.138568718014,-0.019716558969,0.041988191886,0.014746758832,7.430254822205,0.057978239726,-0.140375854150,0.469550484681,0.037516286689 &
            ,0.023445384639,-0.031880497667,0.091024934697,-1.224054673162,-0.044123507792,-0.038886007081,-0.286982736320,-0.049413788196,0.017523816110,0.014655524617,-0.041746338431,-1.539146444266 &
            ,0.008070470305,-0.043731593483,-0.166365282019,0.000461270255,0.055353008200,0.023398968747,-0.034222767131,0.470121813828,-0.039191849545,-0.012819571406,-0.165259831192,0.051905732534 &
            ,-0.071414710785,-0.049115339879,-0.054064848806,0.578608859899,0.059091031978,0.046832758348,0.028991071672,-0.094711120428,0.035005294731,0.010102468108,-0.022414728087,-0.191662039682 &
            ,-0.009740963924,-0.035534044369,-0.068258280686,0.036769850610,0.012941353385,0.044972363596,-0.071611701759,-1.966731249755,0.023918173496,-0.004356487414,-0.148360882760,0.031426078388 &
            ,0.027576569347,0.011715474885,-0.162682514616,-3.014408876647,0.050642967449,-0.190771530910,-0.088981941949,-0.009915112101,-0.027249716913,-0.011356061807,-0.024286140016,-0.331587024219 &
            ,0.026209824760,-0.078668611056,0.047491764578,-0.058426824372,-0.108958467515,-0.011734665350,-0.163192427324,-0.443248913637,0.034731976401,-0.166914994303,0.015074425278,-0.307545783314 &
            ,0.084173668110,0.092709496422,-0.747769838026,-7.480131177692,0.294324807215,-0.487152790523,2.785583583251,0.444336844117,0.598384170196,0.324610058434,0.254970760611,-8.068029402832 &
            ,-0.419038488217,-2.194561937653,1.355324180438,0.290657579365,-1.087962329252,-0.563947691876,-0.672625406982,-1.405712633719,0.739972043932,-1.224218411596,-2.731089806786,-2.536478817275 &
            ,0.084277380235,0.146140772411,1.403750864548,-5.234349481360,-0.501745637491,0.716681227640,-2.770746446111,-0.053220201193,0.082524381333,0.013353856307,-0.587534078702,1.889286124049 &
            ,-0.152690092699,1.457854259528,1.237378044306,0.547845338839,-0.074356333473,-0.146070263438,0.685014368288,1.980384829628,0.171519129493,-1.147455908314,-2.767785458408,-0.573263514214 &
            ,-0.624869402242,-0.260367687240,0.226042382544,-6.700280352692,0.005129429316,2.404853518287,0.205656590321,-0.498507312703,1.181912342800,1.059772544749,-0.327210005845,-8.622472405073 &
            ,-1.213479942531,-1.972522168377,1.856118857548,0.867350186001,-0.524729739628,-0.164878322651,-0.052406434947,2.723693411790,-0.087619573239,1.780292664528,-1.196523813173,-0.438275133348 &
            ,-0.901254740300,-0.811054038769,0.088678150871,-1.990785465740,-0.025758156411,1.633260539506,-1.235535425278,-1.144431893537,-0.182793555030,0.020881864347,-0.109834884650,2.458610287804 &
            ,0.009704815945,0.345158440852,-0.139677591653,-0.230166321350,0.018647822265,-0.096468511246,-0.040527336313,1.828736905609,-0.088319936331,0.520553433482,-0.673143307581,0.036911958585 &
            ,0.054715862497,-0.061866869461,-0.053348927044,1.600061115077,-0.014693789443,-0.262648205744,-0.071470748250,0.009857813355,0.148817271033,0.080552747771,-0.311817731117,0.897152289521 &
            ,-0.014137854779,-0.035846309018,-0.633639038406,0.149766998976,0.188004615336,-0.053758434931,-0.129316182095,-0.454031805774,-0.094354679153,0.198222667517,-0.368019680665,0.322537256837 &
            ,-0.038681077270,-0.212996874549,0.131512602652,0.213977677842,0.005023123943,0.651149945226,0.145932589779,0.183866777843,0.079747204098,-0.230894682950,-0.192856849602,1.092417029649 &
            ,0.042827097073,0.815302281247,-1.129189518871,0.345569335267,-0.025790590908,-0.153379633224,0.081623558034,0.831530577620,0.150067049877,0.382430792711,-1.526416267041,0.154228762730 &
            ,-0.506545503019,0.016429546958,0.171667763093,0.841630111083,0.682946852205,-1.979148041203,3.147572810942,-0.711171253127,-0.478044763833,0.109315107824,-0.428977886249,2.343256863365 &
            ,0.648304428159,0.445183949815,1.136673801383,-0.322094060040,-0.728052078621,-0.210570703875,0.567359815222,5.776546464700,1.450969744903,-0.152836557112,2.591265125991,0.258045813260 &
            ,-0.068095095345,-0.794284494884,-0.169664675632,8.911845501928,-0.192100885049,0.853262842906,-1.675544908249,0.082999832314,-0.770362355219,-1.035532468608,-0.135492642726,3.808861731401 &
            ,0.201521624654,-0.309948411859,0.693329039797,-1.177701696302,-0.618241530583,-0.184168085105,-0.037363242880,6.215589876774,-1.351455258155,3.882407845713,-3.545319612585,-1.736114512182 &
            ,-0.745254007569,0.370727622478,1.362973243558,-0.723250389538,-0.738180110190,1.374936806744,-0.863241448316,-1.904614236743,-0.065160359811,0.298938000061,1.413729958965,1.829582064950 &
            ,-1.190513366948,2.486589374906,-3.240005214143,-0.647394974681,0.255831926890,-0.235489202728,1.269198262305,-1.014415392892,0.707101784386,0.039777772264,2.174230291268,1.604435954288 &
            ,0.834905273606,-0.413133380993,0.065934256051,2.857422574504,-0.208687564191,-0.555138978036,0.609997506006,1.441031855250,-0.013798692601,0.256343698174,-0.163300360823,1.769353211921 &
            ,0.240249082828,-0.298212291488,0.598250819396,0.078258996393,-0.007765936869,0.021155113465,-0.039528351950,-6.382854087368,-0.092185147237,0.002845104465,0.004632286639,-0.137317293789 &
            ,0.000434569973,-0.009107945159,0.200298534895,0.841939433256,0.045547042461,-0.270269698354,0.386854044609,0.001668104060,0.144683943088,-0.013271933346,-0.099581568114,-0.676694245566 &
            ,0.077380957829,0.059356944636,-0.336011397645,0.363072288271,0.027507444438,-0.186479472746,0.200177049544,4.020922593347,0.093787079145,0.212580521602,0.019335112829,0.263415317675 &
            ,0.166063939226,0.045572626153,-0.371727420923,2.321267864651,-0.013381212472,-0.377059705855,0.478118155471,0.241597017150,-0.047491718646,-0.028949344793,-0.238613138530,-7.232017748108 &
            ,-0.007522706183,-0.528363257861,1.006845037245,-0.169443275046,0.153121523377,-0.248912376843,0.026536691619,0.873548000944,-0.128155151195,-0.619028201609,-0.349309462914,-0.090884209708 &
            ,1.067483837219,0.693550979677,-0.958759493918,3.533128627571,-0.976466725038,-2.888044609444,-3.626473131028,-0.356816929547,-2.292457551156,-0.626473689182,2.057661525076,2.866248435426 &
            ,0.223495035015,5.623023310021,4.063201630712,-1.549132450162,0.360211654430,-0.086310602316,1.552275968528,1.016671032167,-0.374746305470,-3.999561729355,0.585919173505,-0.745411280563 &
            ,1.398674964889,0.260927584026,-1.610177955651,-0.389446298150,0.056683605322,-4.473161243956,-4.842756890464,0.474699886582,-1.386954848824,-0.353968659875,2.725063085025,-0.559442855651 &
            ,-1.051415354467,5.762491212016,-2.658199531585,-1.539878265323,2.639314260001,0.520673925158,0.913851288140,-0.484924740746,-0.483190796625,-2.918658729304,6.360398663594,4.631973818949 &
            ,-0.428145119384,-0.099639288139,-2.483228441343,-0.166454074574,0.995238126382,-0.534433346332,8.786980430342,0.010841545075,2.354402093977,0.368203445452,-0.569473979314,0.294471652148 &
            ,0.573394858639,2.113155633913,7.998009388693,6.474689393584,-1.537529809741,-0.601411358034,-1.338767212837,0.917009544865,0.824187620343,3.710398682941,0.120194785982,-3.568879438549 &
            ,4.146345346801,1.631982109787,2.827142377608,1.008786125364,-2.512411097122,-1.312169829139,0.072460910748,1.004930535704,0.908519068568,3.201245551233,-1.739981528564,0.499829986623 &
            ,-0.321201822810,-1.223502549684,0.795892582299,0.680231152777,-0.086581916797,-1.834965597302,0.227165277598,0.621274438869,0.657903434326,0.125105111734,-0.264562727391,0.099766538283 &
            ,-0.832989899930,1.867991005452,-0.233643417830,0.960424608092,0.815968239770,0.561443879219,-1.470332620507,-0.227087925066,-0.112516283678,0.252778688240,-0.814900645886,1.443463999736 &
            ,0.600648677853,-0.616336132405,-2.593181040792,-1.385270507089,-0.423800399686,-0.729483895719,-0.408432405707,1.943413617491,0.598067245617,-1.505489016059,-3.401973620887,-1.887425037352 &
            ,1.214268317284,1.531664225938,-0.517842522682,2.180970029124,-1.460801438334,-1.003385487418,-3.386584257781,-1.396879903809,-0.155033380348,1.784921455482,1.286866844888,2.112832435778 &
            ,0.819553953873,-1.560073416011,-3.230134007446,2.372261453453,0.141794924175,-0.845678197661,2.444499255298,2.437866908998,0.079947111162,-3.146761747199,-2.139090349579,-1.936068678532 &
            ,-0.011228920246,-0.082518570012,-0.060597167234,3.804958683023,0.181972493380,1.147677913827,4.617298900859,0.984964958893,0.168618964808,0.347144369252,-0.998474087696,8.017666789302 &
            ,-0.062264771967,-1.000112042111,-1.174284252515,-0.239624972666,-0.929561009174,-0.311657756854,-0.439295537351,9.609380987807,0.259873788349,-0.613528160283,-4.816003401964,-2.482424475825 &
            ,0.719508998509,0.281641217368,1.802403027096,8.480483044916,-0.727245755687,-0.417327782086,1.516937671683,1.253902207556,-1.058791134051,-0.126782512568,-1.268189665559,7.028316747028 &
            ,0.834994897387,0.297343126377,8.285781683309,-0.820836033060,0.518636001060,-0.313274457700,0.004199442872,5.625258614113,0.505900228787,-1.952035809968,10.461519447054,0.944954287543 &
            ,0.342106310808,0.153628049541,1.615334169551,5.192747596657,-1.000654632829,1.086704246902,3.348334322893,-0.250213194738,2.368038320241,-0.399313053390,0.542442506488,3.613953969204 &
            ,-0.440074271894,-3.691128557480,9.199079091897,-0.401109198114,7.303930068489,0.484104415284,1.234500450380,-0.088880829234,-0.950455399379,-3.684500463627,17.101813504225,5.180181502709 &
            ,9.300565856796,2.756697758095,0.094049926714,-0.271082593690,-0.335150315902,1.799823978613,-2.924825528584,0.805566316449,2.149381211663,6.571311705194,0.476203878634,3.916616184235 &
            ,-0.562019799798,2.255355141777,-4.485368687470,3.621450465700,0.901508229238,-1.084300006844,0.127179875983,3.258628299148,0.253271596920,3.098820661338,-2.482002536564,1.024133445920 &
            ,0.919022523613,3.271501641429,-0.157045793298,2.301677946015,-0.051528340604,1.759496960632,-3.064218596959,0.390168165329,0.562915022212,3.539604229831,-0.551701211795,1.702522140961 &
            ,0.662890699187,1.119577927990,-2.015104883443,0.393948048342,0.326986466761,3.091903315807,-0.417281605396,3.945217937940,0.902182701213,1.630485612598,-4.372191616204,0.552725589874 &
            ,-0.514766613518,4.263679185150,0.999634478208,3.747323849372,0.501722207256,8.623491968719,-2.364047018746,0.846033260302,-1.048106809308,3.140934841060,0.561423679822,3.148820879079 &
            ,1.494554842900,4.225246138498,-3.311091406209,-0.001241920649,-1.378677273780,0.999471725596,2.038811055789,3.093702248153,2.236068419664,-0.629930572949,-3.565916212173,-0.339817738927 &
            ,0.045069923959,0.031089568079,-0.292540810519,2.126009837950,0.171280640232,0.142081465111,-0.357507976238,0.208454670316,0.099449995341,-0.048322780841,-0.156464181414,7.140119144896 &
            ,0.020932282901,-0.171407650965,-0.425371206078,0.095672887139,-0.133534638864,-0.252814885253,-0.366299968757,-2.139380111467,0.208035024120,0.526821358001,-0.966845788300,-0.188422154879 &
            ,-0.008771487339,0.173119263095,0.166649356622,-0.325662327443,-0.040400555234,0.371342378625,0.257128627296,0.181749071930,-0.068459415586,-0.191002216508,0.186351157909,6.448481733809 &
            ,-0.017840153359,0.083047626829,-0.533830323278,-0.186431783154,-0.071257489961,-0.127204959424,0.102017019315,-6.825376127760,0.034960899365,0.199086435078,-0.695616475786,-0.124372249930 &
            ,-0.358802908279,0.077153647097,0.375483565544,2.271589310781,-0.057152028359,0.889225475186,-0.965531839435,-0.430104126966,-0.206066780971,-0.300071450125,-0.114924907913,2.418996223202 &
            ,0.137019938702,1.132819436173,-0.739457704767,0.119044371522,-0.113727400311,-0.055237163080,-0.067200174332,7.361246896482,0.170778654154,-0.443507979992,0.438955179714,0.244961773083 &
            ,-0.555819812744,0.008659028920,0.121728719565,-2.607017696175,-0.072485666845,-0.055920544695,0.511804771062,-0.213784571974,0.084658427895,-0.093464149983,-0.101715852377,1.003550500935 &
            ,-0.029961536896,-0.351175714874,0.231553849140,0.100831093480,-0.071634814698,-0.074988988889,-0.011259272575,1.842857582567,-0.013837405650,-0.096650879355,0.162811061077,-0.113808081405 &
            ,-0.127503963426,-0.149723077151,-0.082364999031,0.623254683508,0.032399822778,0.029601142019,-0.050078789644,-0.161242399520,-0.033144617762,-0.202852345500,-0.036151381539,-0.132512366100 &
            ,-0.044208598241,-0.065360087714,0.145430533744,-0.077010553059,-0.081370064750,-0.212958614572,-0.073757957894,0.314167704565,0.040828344656,-0.026176641214,0.185999478985,-0.067513406872 &
            ,0.032906544970,-0.032185997965,0.020372292396,0.229685476378,-0.116091214229,-0.218976752843,0.417706579705,0.010867536913,-0.229813632868,-0.350440296601,0.078115407400,-2.003323829046 &
            ,0.079778717606,0.386315293280,-0.465246517759,-0.274548033341,0.135807816695,-0.274559610979,-0.215014186923,-2.560667993256,-0.001641304264,-0.445386177041,-0.268979595388,-0.010156368560 &
            ,0.199394702042,0.069455360183,-0.087038232614,-1.619935120496,-0.117264659695,0.447758246050,-1.829578490690,0.161376961001,-0.074746460307,0.052495541773,-0.018111470674,0.100315275426 &
            ,-0.147991196879,0.916292619736,-2.067506528174,-0.267843524668,0.040768455320,0.074079009246,0.023658470587,0.861091694724,-0.016876554371,-0.179475712719,-0.232412480003,0.017358104856 &
            ,0.014504986807,-0.090086787794,0.093997283030,1.621435502920,-0.070845869301,0.186546395849,-0.551363162139,-0.044285554219,0.025808457770,-0.084797604373,-0.049625060760,-0.309801615049 &
            ,0.036925543902,0.075363108956,-0.342485942613,0.059092502499,0.017124548735,0.001705691889,-0.017216193015,0.735049181703,-0.015089166865,-0.015069884913,-0.143420792941,0.006838668094 &
            ,0.074561016169,0.112344966839,-0.098766815282,-1.510536201386,-0.065288508781,-0.016231095297,0.596066966305,0.192390649779,0.042469143268,0.008975996637,-0.206956703215,0.110898280750 &
            ,-0.005695165967,0.222178768047,0.343864981600,0.215475950549,0.185526393720,0.126567248751,-0.467225120666,-3.469071022147,-0.089648920884,0.007095658554,0.658403023038,0.327049252505 &
            ,0.067811505000,-0.063889966559,-0.483903556048,-0.142053279766,0.017853514905,-0.068648661933,0.010904823765,0.020322304573,-0.076376389080,-0.037957612297,0.052419555587,0.051321679890 &
            ,0.024766619933,0.087152206395,-0.033274928749,-0.101466621045,-0.016109516158,-0.009838117564,-0.015907195275,1.078740075822,0.002928335747,0.043691878737,-0.035356770539,-0.019542052290 &
            ,-0.003736294339,0.022602843827,-0.019997119061,0.359132788496,-0.010547400492,0.003413767110,0.061408660224,-0.008368610411,0.012657715339,0.037321115757,-0.054246995627,-0.268603316534 &
            ,-0.016299571733,-0.005515548479,-0.012012878927,0.004902020598,0.011937543951,-0.010469589105,-0.047234719797,0.064115880712,0.003706676351,0.001635289037,0.028327316792,0.022821425940 &
            ,-0.019198911814,-0.031553049298,-0.025367664149,0.302366583397,0.031182447961,0.015218741732,-0.064155190190,-0.019545634173,0.012508647219,0.035720991473,-0.022678941130,0.651196537365 &
            ,-0.029476076019,-0.087028543265,0.101197567872,-0.016182413506,-0.033179517885,0.038047879977,-0.042029194947,0.203548859878,-0.016571909606,0.004785009586,0.159045911146,-0.051953207046 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-0.01496,-18.3547 &
            ,6.8471,16.2455,0.099568,-10.4566 &
            ,-3.6962,-13.6984 &
            ,0.1051,-15.7761 &
            ,0.00058651,-2.6263 &
            ,-0.013883,-1.298 &
            ,0.040453,9.3745 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-5.4741,0.58076/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/0.19016,1.0768,-4.4792,0.65961,-1.5691,-7.7773,6.559,2.8566/)
real, dimension(2) :: bias2 = &
  (/-5.1081,8.9262/)
real, dimension(1) :: bias3 = &
  (/0.98477/)
contains
subroutine fnet_MTZ_initall()
end subroutine fnet_MTZ_initall
subroutine fnet_MTZ_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
    inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_MTZ_engine
end module fnet_MTZ
